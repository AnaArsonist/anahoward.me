{"version":3,"sources":["../../../src/telemetry/storage.ts"],"names":["ciEnvironment","TELEMETRY_KEY_ENABLED","TELEMETRY_KEY_NOTIFY_DATE","TELEMETRY_KEY_ID","TELEMETRY_KEY_SALT","getStorageDirectory","distDir","isLikelyEphemeral","isCI","isDockerFunction","path","join","undefined","Telemetry","constructor","NEXT_TELEMETRY_DISABLED","NEXT_TELEMETRY_DEBUG","process","env","storageDirectory","conf","Conf","projectName","cwd","_","sessionId","randomBytes","toString","rawProjectId","getRawProjectId","queue","Set","notify","isDisabled","get","set","Date","now","console","log","chalk","magenta","bold","cyan","anonymousId","val","generated","salt","setEnabled","_enabled","enabled","isEnabled","oneWayHash","payload","hash","createHash","update","digest","projectId","record","_events","deferred","prom","Promise","resolve","isFulfilled","isRejected","value","submitRecord","then","catch","reason","res","delete","Array","isArray","_controller","add","flush","all","flushDetached","mode","dir","allEvents","forEach","item","abort","push","fs","writeFileSync","JSON","stringify","spawn","execPath","require","detached","windowsHide","shell","stdio","events","length","eventName","error","context","meta","getAnonymousMeta","postController","AbortController","_postPayload","map","fields","signal"],"mappings":"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"}