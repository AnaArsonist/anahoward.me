{"version":3,"sources":["../../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","memoryCache","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","maxMemoryCacheSize","max","length","value","JSON","kind","stringify","props","Error","data","html","pageData","get","key","fetchCache","filePath","isAppPath","getFsPath","pathname","fileData","readFile","mtime","stat","lastModified","getTime","parse","set","_","Date","now","htmlPath","mkdir","dirname","writeFile","join","err"],"mappings":"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"}